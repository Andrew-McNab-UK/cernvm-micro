include $(TOP)/config.mk
include config.mk

NTPCLIENT_BINARY = ntpclient-$(NTPCLIENT_STRONG_VERSION)/bin/ntpclient
NTPCLIENT_BUILD_PRODUCT = $(NTPCLIENT_SOURCETREE)/ntpclient
NTPCLIENT_STRIPPED = $(NTPCLIENT_BUILD_PRODUCT)-stripped
NTPCLIENT_MAKEFILE = $(NTPCLIENT_SOURCETREE)/Makefile

all: $(NTPCLIENT_BINARY)

clean:
	rm -rf ntpclient-*

$(NTPCLIENT_BINARY): $(NTPCLIENT_STRIPPED)
	mkdir -p ntpclient-$(NTPCLIENT_STRONG_VERSION)/bin
	cp $(NTPCLIENT_STRIPPED) $(NTPCLIENT_BINARY)

$(NTPCLIENT_STRIPPED): $(NTPCLIENT_BUILD_PRODUCT)
	cp $(NTPCLIENT_BUILD_PRODUCT) $(NTPCLIENT_STRIPPED)
	strip $(NTPCLIENT_STRIPPED)

$(NTPCLIENT_BUILD_PRODUCT): $(NTPCLIENT_MAKEFILE)
	$(MAKE) -j4 -C $(NTPCLIENT_SOURCETREE)

$(NTPCLIENT_MAKEFILE): | $(NTPCLIENT_TARBALL)
	tar -xvzf $(NTPCLIENT_TARBALL)

$(NTPCLIENT_TARBALL):
	curl $(NTPCLIENT_SOURCE) > $(NTPCLIENT_TARBALL) 2>/dev/null || rm -f $(NTPCLIENT_TARBALL)
