include $(TOP)/config.mk
include config.mk

DHCLIENT_BINARY = dhclient-$(DHCLIENT_STRONG_VERSION)/bin/dhclient
DHCLIENT_BUILD_PRODUCT = $(DHCLIENT_SOURCETREE)/client/dhclient
DHCLIENT_STRIPPED = $(DHCLIENT_BUILD_PRODUCT)-stripped
DHCLIENT_MAKEFILE = $(DHCLIENT_SOURCETREE)/Makefile
DHCLIENT_CONFIGURE = $(DHCLIENT_SOURCETREE)/configure

all: $(DHCLIENT_BINARY)

clean:
	rm -rf dhcp-*

$(DHCLIENT_BINARY): $(DHCLIENT_STRIPPED)
	mkdir -p dhclient-$(DHCLIENT_STRONG_VERSION)/bin
	cp $(DHCLIENT_STRIPPED) $(DHCLIENT_BINARY)

$(DHCLIENT_STRIPPED): $(DHCLIENT_BUILD_PRODUCT)
	cp $(DHCLIENT_BUILD_PRODUCT) $(DHCLIENT_STRIPPED)
	strip $(DHCLIENT_STRIPPED)

$(DHCLIENT_BUILD_PRODUCT): $(DHCLIENT_MAKEFILE)
	$(MAKE) -j4 -C $(DHCLIENT_SOURCETREE)

$(DHCLIENT_MAKEFILE): $(DHCLIENT_CONFIGURE)
	cd $(DHCLIENT_SOURCETREE) && CFLAGS=-Os ./configure

$(DHCLIENT_CONFIGURE): | $(DHCLIENT_TARBALL)
	tar -xvzf $(DHCLIENT_TARBALL)

$(DHCLIENT_TARBALL):
	curl $(DHCLIENT_SOURCE) > $(DHCLIENT_TARBALL) 2>/dev/null || rm -f $(DHCLIENT_TARBALL)
